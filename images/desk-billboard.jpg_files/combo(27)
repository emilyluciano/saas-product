YUI.add("search-photos-route",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Routes[this.name]=t,e.extend(t,e.FlickrRoute,{langBundles:this.details.langBundles,run:function(e){return this.appContext.flipper.isFlipped("reboot-unified-search")?this.runSearchUnified(e):this.runSearchStandard(e)},runSearchUnified:function(t){var n={},r,i=this,s,o=!0,u=!1,a=!0,f=e.SearchUrl.searchTypes.GENERAL;return n.apiParams=this.processRequest(t),n.id=e.SearchHelper.generateQueryString(n.apiParams)||e.guid(),n.apiParams.text&&(s=n.apiParams.text),t.probableUser?n.viewerNsid=t.probableUser:n.viewerNsid=this.appContext.getViewer().nsid,r={perPage:25},e.FlickrPromise({counts:this.appContext.getModel("search-counts-models",n,r),everyone:this.appContext.getModel("search-photos-lite-models",n,r)}).then(function(t){var r=i.appContext.getViewer(),l=t.everyone;return r.signedIn&&!n.apiParams.view_all&&(f=e.SearchUrl.searchTypes.UNIFIED,o=!1),r.signedIn&&n.apiParams.user_id===r.nsid&&(f=e.SearchUrl.searchTypes.YOURS,o=!0),r.signedIn&&n.apiParams.contacts&&(f=e.SearchUrl.searchTypes.CONTACTS,o=!0),n.apiParams.user_id&&(f=e.SearchUrl.searchTypes.NSID,o=!0),o&&(u=!0),e.Promise.resolve({view:"search-photos-unified-page-view",params:{searchId:YUI.Env.isServer?l.id:l.id,searchTerm:s,searchType:f,modelParams:n,showTools:o,showAdvanced:a,showSort:u},layout:"scrolling",fluid:!0})},function(t){return i.appContext.warn("search-photos-route",t.message),e.Promise.resolve({view:"search-photos-unified-page-view",params:{searchTerm:s,apiFailed:!0},fluid:!0})})},runSearchStandard:function(t){var n={},r,i=this,s=i.intlMessage({intlName:"search.FLICKR_SEARCH"}),o=": ",u,a,f;return n.apiParams=this.processRequest(t),n.id=e.SearchHelper.generateQueryString(n.apiParams)||e.guid(),n.apiParams.text?(u=n.apiParams.text,a=o+n.apiParams.text):n.apiParams.tags&&(a=o+n.apiParams.tags),f=e.flutil.unescape(a),r={perPage:e.SearchHelper.PREFETCH_PAGE_SIZE},this.appContext.getModel("search-photos-models",n,r).then(function(t){return e.Promise.resolve({view:"search-photos-page-view",params:{searchId:YUI.Env.isServer?t.id:t.id,searchTerm:u},title:t.getValue("emptyQuery")||!f?s:s+f,layout:"scrolling"})},function(t){return i.appContext.warn("search-photos-route",t.message),e.Promise.resolve({view:"search-photos-page-view",params:{searchTerm:u,apiFailed:!0},title:f?s+f:s})})},processRequest:function(t){var n={};return n=e.merge(t.query,e.SearchHelper.mapRouteParamsToAPI(t.params)),n=e.SearchHelper.mapClassicSearchToAPI(n,this.appContext),e.SearchHelper.addParamDefaults(n),YUI.Env.isServer&&e.SearchHelper.unescapeParameters(n),n}}),e.mix(t.prototype,e.Localizable)},"@VERSION@",{requires:["flutil","flickr-route","flickr-promise","search-helper","querystring-stringify-simple","localizable","search-photos-models","search-photos-lite-models","url","search-url","search-photos-page-view","search-photos-unified-page-view"],langBundles:["search"]});
